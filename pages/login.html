<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Это заголовок тайтл</title>
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel = "stylesheet" type = "text/css" href = "/css/style.css">
   		
	</head>
	<style>
	   			   
    </style>
	<body>
	   <video autoplay loop muted preload = "none" class = "bgvideo">
	       <source src = "/videos/video1.mp4" type = "video/mp4"></source>
	   </video>
	   <header>
	  
	   </header>
	   <div id = "loginform">
	   <form name = "login">
          <label>Логин</label><br>
          <input type="text" name="userLogin" /><br><br>
          <label>Пароль</label><br>
          <input type="text" name="userPassword" /><br><br>
          <button id = "entermain" class = "btns">Войти</button>
		  <button id = "registeruser" class = "btns">Зарегистрироваться</button>
       </form>
	   </div>
	</body>
	<script>
	    window.onload = function(){
		  let entermain = document.getElementById('entermain');
		  let registeruser = document.getElementById('registeruser');
		  let inputs = document.getElementsByTagName('input');
		  
		    /*let once = function (func) {
              let result;

              return function () {
               if (func) {
                result = func.apply(this, arguments);
                func = null;
               }

              return result;
             }
            };*/
		  
		    async function auth(){
		     console.log('1');
		     let path;
		  
		     let userData = {
		       userlogin:inputs[0].value,
			   userpassword:inputs[1].value
		     };
		  
		     path = userData.userlogin;
		  
		      await fetch('/admin',{
			   method:'POST',
			   mode:'cors',
			   redirect:'follow',
			   headers: {
			     'Content-type':'application/json',
			   },
			   body: JSON.stringify(userData),
			 })
			 .then(response =>  
			 {
			    if (response.redirected){
				  document.location = response.url;
				}
			 })
			 .then(data => {
			   console.log('OK:',data);
			 })
			 .catch((error) => {
			   console.error('Error:',error," url: ",url);
			 });
			 console.trace();
			 console.log(path);
			 return path;
		  }
		  
		  /*async function enter(){
		    let param = await auth();
		    console.log('2');
			if (param == "admin"){
			  param = "admin";
			} else {
			  param = "user";
			}
	
	        fetch('/' + param,{
			  method:'GET',
			})
			.then(response => {
			  console.log(response.redirected);
			  //if (response.redirected){
			    window.location.href = '/' + param;
			  //}
			})
			.catch((error) => {
			   console.error(error);
			});

			return param;
		  }*/
		  
		  entermain.onclick = async function(e){
		     e.preventDefault();
			 await auth();
		  }
		  
		  registeruser.onclick = function(e){
		    e.preventDefault();
		    window.location.href = '/register';
		  }
		}
		
    </script>
</html>